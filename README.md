# Описание архитектуры и работы приложения "LoginNotifications"

## Основные компоненты и архитектура

Приложение построено на основе архитектурного паттерна **MVVM (Model-View-ViewModel)**, что позволяет разделить логику приложения и представление интерфейса, а также упростить поддержку и тестирование.

- **View** — в `SwiftUI` все представления описаны декларативно. Основные экраны приложения включают:
  - **LoginView**: экран входа, где пользователь вводит логин.
  - **ConfirmationView**: экран подтверждения, где отображается информация о попытке входа и кнопки "Approve" и "Deny" для принятия или отклонения запроса.
  
- **ViewModel** (`LoginViewModel`) — связывает интерфейс (View) с логикой (Model):
  - Отвечает за получение и обработку данных от сервера.
  - Хранит состояния и данные, такие как `loginAttempt`, `showConfirmation`, `requestApproved`, и управляет логикой проверки, отображения и обновления запросов.
  - **Таймер обновлений** запускается для периодической проверки наличия новых запросов входа.

- **Model**:
  - **LoginAttemptModel** и **DecisionModel** — структуры данных, описывающие попытку входа и решение пользователя, соответственно.

## Основные сценарии работы приложения

### 1. Экран входа (LoginView)

- Пользователь вводит логин и нажимает "Войти".
- При нажатии на кнопку вызывается метод `checkLoginAttempt` в `LoginViewModel`:
  - Если для указанного логина есть попытка входа, `loginAttempt` обновляется, и отображается `ConfirmationView`.
  - Если попытки входа нет, отображается пустой экран ожидания с часами, пока не будет создан новый запрос.

### 2. Экран подтверждения (ConfirmationView)

- На `ConfirmationView` отображается информация о попытке входа (логин, браузер, ОС, IP).
- **Кнопки "Approve" и "Deny"**: при нажатии обновляется UI, моментально окрашивая границы круга в зависимости от ответа. Затем:
  - Отправляется POST-запрос с решением на сервер.
  - Через 5 секунд интерфейс очищается и обновляется в режиме ожидания следующего запроса.

### Таймер обновлений

- При переходе на экран `ConfirmationView` запускается таймер, вызывающий метод `checkLoginAttempt` каждые 5 секунд.
- Таймер проверяет наличие новых попыток входа для текущего пользователя и обновляет интерфейс при обнаружении.

## Ключевые классы и методы

1. **LoginViewModel**
   - `checkLoginAttempt()` — проверяет наличие попытки входа и, если она существует, обновляет интерфейс.
   - `submitDecision(approved:)` — отправляет решение (approve/deny) на сервер и обновляет интерфейс.
   - `startCheckingForUpdates()` и `stopCheckingForUpdates()` — управление таймером для периодической проверки новых запросов.

2. **ConfirmationView**
   - `handleDecision(approved:)` — управляет обновлением интерфейса и отправкой решения на сервер.
   - UI динамически обновляется при получении новых данных и изменении состояний.

## Обработка сетевых запросов

- Используется **URLSession** для отправки GET и POST-запросов к серверу.
- Приложение обрабатывает JSON-ответы, обновляя отображение информации о попытке входа и отображение состояния "Approved"/"Denied".

## Итог

Такое построение с разделением интерфейса, логики и данных на View, ViewModel и Model улучшает читаемость и тестируемость кода. MVVM помогает упростить управление состояниями и обработку асинхронных запросов к серверу.
